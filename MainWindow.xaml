<Window 
    x:Class="CricutStencilMaker.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <Border Grid.Row="0" Background="{StaticResource PrimaryBrush}" Padding="20,12">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="🎨" FontSize="24" VerticalAlignment="Center" Margin="0,0,12,0"/>
                <TextBlock Text="Cricut Stencil Maker" 
                          FontSize="20" 
                          FontWeight="SemiBold" 
                          Foreground="White" 
                          VerticalAlignment="Center"/>
                <TextBlock Text="v0.9.0" 
                          FontSize="12" 
                          Foreground="#E0FFFFFF" 
                          VerticalAlignment="Bottom" 
                          Margin="8,0,0,2"/>
            </StackPanel>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Row="1" Margin="20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="20"/>
                <ColumnDefinition Width="1*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel - Image and Preview -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Drop Zone / Image Preview -->
                <Border Grid.Row="0" 
                       x:Name="DropZone"
                       Background="{StaticResource SurfaceBrush}"
                       BorderBrush="{StaticResource PrimaryBrush}"
                       BorderThickness="2"
                       BorderDashArray="5,5"
                       CornerRadius="12"
                       AllowDrop="True"
                       Drop="DropZone_Drop"
                       DragOver="DropZone_DragOver"
                       DragLeave="DropZone_DragLeave">
                    
                    <Grid>
                        <!-- Drop Instructions (visible when no image) -->
                        <StackPanel x:Name="DropInstructions" 
                                   HorizontalAlignment="Center" 
                                   VerticalAlignment="Center"
                                   Spacing="16">
                            <TextBlock Text="📁" FontSize="64" HorizontalAlignment="Center" Opacity="0.6"/>
                            <TextBlock Text="Drag &amp; Drop Your Image Here" 
                                      FontSize="24" 
                                      FontWeight="SemiBold"
                                      HorizontalAlignment="Center"
                                      Foreground="{StaticResource PrimaryBrush}"/>
                            <TextBlock Text="Supports PNG, JPEG, BMP, TIFF, GIF, WebP" 
                                      FontSize="14" 
                                      HorizontalAlignment="Center"
                                      Opacity="0.8"/>
                            <Button Content="Or Browse Files..." 
                                   Style="{StaticResource SecondaryButtonStyle}"
                                   HorizontalAlignment="Center"
                                   Click="BrowseFiles_Click"/>
                        </StackPanel>

                        <!-- Image Preview (visible when image loaded) -->
                        <Grid x:Name="ImagePreviewArea" Visibility="Collapsed">
                            <Image x:Name="PreviewImage" 
                                  Stretch="Uniform"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"/>
                            
                            <!-- Overlay Canvas for Background Removal Brush -->
                            <Canvas x:Name="BrushCanvas" 
                                   Background="Transparent"
                                   PointerPressed="BrushCanvas_PointerPressed"
                                   PointerMoved="BrushCanvas_PointerMoved"
                                   PointerReleased="BrushCanvas_PointerReleased"/>
                        </Grid>
                    </Grid>
                </Border>

                <!-- Preview Mode Controls -->
                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,12,0,0" Spacing="8">
                    <TextBlock Text="Preview Mode:" VerticalAlignment="Center" FontWeight="SemiBold"/>
                    <ComboBox x:Name="PreviewModeCombo" 
                             SelectionChanged="PreviewMode_SelectionChanged"
                             MinWidth="150">
                        <ComboBoxItem Content="Original Image" IsSelected="True"/>
                        <ComboBoxItem Content="Background Removed"/>
                        <ComboBoxItem Content="Cut Lines"/>
                        <ComboBoxItem Content="Weed View"/>
                        <ComboBoxItem Content="Bridge View"/>
                    </ComboBox>
                </StackPanel>
            </Grid>

            <!-- Right Panel - Controls -->
            <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto">
                <StackPanel Spacing="20">
                    
                    <!-- Background Removal Section -->
                    <Expander Header="🎯 Background Removal" IsExpanded="True">
                        <StackPanel Spacing="12" Margin="0,12,0,0">
                            <Button Content="Auto Remove Background" 
                                   Style="{StaticResource PrimaryButtonStyle}"
                                   Click="AutoRemoveBackground_Click"
                                   IsEnabled="False"
                                   x:Name="AutoRemoveButton"/>
                            
                            <TextBlock Text="Manual Refinement:" FontWeight="SemiBold"/>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Button Content="✏️ Erase" 
                                       x:Name="EraseButton"
                                       Click="EraseMode_Click"
                                       MinWidth="80"/>
                                <Button Content="🖌️ Restore" 
                                       x:Name="RestoreButton"
                                       Click="RestoreMode_Click"
                                       MinWidth="80"/>
                            </StackPanel>
                            
                            <TextBlock Text="Brush Size:"/>
                            <Slider x:Name="BrushSizeSlider" 
                                   Minimum="5" Maximum="50" Value="15"
                                   ValueChanged="BrushSize_ValueChanged"/>
                            
                            <TextBlock Text="Edge Smoothness:"/>
                            <Slider x:Name="EdgeSmoothnessSlider" 
                                   Minimum="0" Maximum="100" Value="50"/>
                        </StackPanel>
                    </Expander>

                    <!-- Material Presets Section -->
                    <Expander Header="🎨 Material Presets">
                        <StackPanel Spacing="12" Margin="0,12,0,0">
                            <RadioButton Content="Vinyl / HTV" 
                                        IsChecked="True" 
                                        x:Name="VinylPreset"
                                        Checked="MaterialPreset_Checked"/>
                            <RadioButton Content="Mylar / Stencil Film" 
                                        x:Name="MylarPreset"
                                        Checked="MaterialPreset_Checked"/>
                            
                            <!-- Bridge Controls (visible for Mylar) -->
                            <StackPanel x:Name="BridgeControls" Visibility="Collapsed" Spacing="8">
                                <CheckBox Content="Add Bridges" x:Name="AddBridgesCheck" IsChecked="True"/>
                                <TextBlock Text="Bridge Width (mm):"/>
                                <Slider x:Name="BridgeWidthSlider" Minimum="0.5" Maximum="5" Value="2"/>
                                <TextBlock Text="Bridge Spacing:"/>
                                <Slider x:Name="BridgeSpacingSlider" Minimum="5" Maximum="50" Value="20"/>
                            </StackPanel>
                        </StackPanel>
                    </Expander>

                    <!-- Advanced Settings Section -->
                    <Expander Header="⚙️ Advanced Settings">
                        <StackPanel Spacing="12" Margin="0,12,0,0">
                            <TextBlock Text="Detail Level (%):"/>
                            <Slider x:Name="DetailSlider" Minimum="10" Maximum="100" Value="75"/>
                            
                            <TextBlock Text="Path Smoothness:"/>
                            <Slider x:Name="SmoothnessSlider" Minimum="0" Maximum="100" Value="50"/>
                            
                            <TextBlock Text="Min Island Size (mm²):"/>
                            <Slider x:Name="MinIslandSlider" Minimum="1" Maximum="25" Value="5"/>
                            
                            <CheckBox Content="Add Weeding Boxes" x:Name="WeedingBoxesCheck"/>
                        </StackPanel>
                    </Expander>

                    <!-- Size Settings Section -->
                    <Expander Header="📏 Size Settings">
                        <StackPanel Spacing="12" Margin="0,12,0,0">
                            <TextBlock Text="Mat Size:"/>
                            <ComboBox x:Name="MatSizeCombo" SelectionChanged="MatSize_SelectionChanged">
                                <ComboBoxItem Content="11.5 x 11.5 inch Cricut Mat" IsSelected="True"/>
                                <ComboBoxItem Content="23.5 x 11.5 inch Cricut Mat"/>
                                <ComboBoxItem Content="Custom Size"/>
                            </ComboBox>
                            
                            <StackPanel x:Name="CustomSizePanel" Visibility="Collapsed" Spacing="8">
                                <TextBlock Text="Width (inches):"/>
                                <NumberBox x:Name="CustomWidthBox" Value="11.5" Minimum="1" Maximum="24"/>
                                <TextBlock Text="Height (inches):"/>
                                <NumberBox x:Name="CustomHeightBox" Value="11.5" Minimum="1" Maximum="24"/>
                                <CheckBox Content="Lock Aspect Ratio" IsChecked="True"/>
                            </StackPanel>
                        </StackPanel>
                    </Expander>

                    <!-- Export Section -->
                    <Border Background="{StaticResource SurfaceBrush}" 
                           Padding="16" 
                           CornerRadius="8"
                           BorderBrush="{StaticResource PrimaryBrush}"
                           BorderThickness="1">
                        <StackPanel Spacing="12">
                            <TextBlock Text="📤 Export" 
                                      FontSize="16" 
                                      FontWeight="SemiBold"/>
                            
                            <TextBlock x:Name="ExportStatusText" 
                                      Text="Load an image to begin"
                                      FontStyle="Italic"
                                      Opacity="0.8"/>
                            
                            <Button Content="Export SVG for Cricut Design Space" 
                                   Style="{StaticResource PrimaryButtonStyle}"
                                   HorizontalAlignment="Stretch"
                                   Click="ExportSVG_Click"
                                   IsEnabled="False"
                                   x:Name="ExportButton"/>
                            
                            <Button Content="Batch Process Multiple Images" 
                                   Style="{StaticResource SecondaryButtonStyle}"
                                   HorizontalAlignment="Stretch"
                                   Click="BatchProcess_Click"/>
                        </StackPanel>
                    </Border>

                </StackPanel>
            </ScrollViewer>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2" Background="#F0F0F0" Padding="20,8">
            <StackPanel Orientation="Horizontal" Spacing="20">
                <TextBlock x:Name="StatusText" Text="Ready" VerticalAlignment="Center"/>
                <ProgressBar x:Name="ProcessingProgress" 
                            Width="200" 
                            Visibility="Collapsed"
                            VerticalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>